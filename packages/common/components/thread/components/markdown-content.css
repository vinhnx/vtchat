/* Markdown content styling with enhanced typography and readability */

/* Define CSS variables for consistent styling */
:root {
    /* Typography */
    --markdown-font-family:
        'SF Pro Display', -apple-system, BlinkMacSystemFont, 'Helvetica Neue', Arial, sans-serif;
    --markdown-font-size: 17px;
    --markdown-line-height: 1.75;
    --markdown-font-weight-normal: 400;
    --markdown-font-weight-medium: 500;
    --markdown-font-weight-semibold: 600;
    --markdown-font-weight-bold: 700;

    /* Light theme colors */
    --markdown-text-color: #111827; /* Dark gray for better contrast */
    --markdown-heading-color: #000000; /* Pure black for headings */
    --markdown-link-color: #2563eb; /* Accessible blue */
    --markdown-code-bg: #f3f4f6; /* Light gray background for inline code */
    --markdown-code-border: #e5e7eb; /* Light border for code */
    --markdown-blockquote-color: #4b5563; /* Medium gray for blockquotes */
    --markdown-blockquote-border: #d1d5db; /* Light gray border for blockquotes */
    --markdown-table-border: #e5e7eb; /* Light gray for table borders */
    --markdown-table-header-bg: #f9fafb; /* Very light gray for table headers */
    --markdown-hr-color: #e5e7eb; /* Light gray for horizontal rules */
    --markdown-pre-bg: #f8fafc; /* Very light gray for code blocks */
    --markdown-pre-border: #e5e7eb; /* Light border for code blocks */

    /* Spacing */
    --markdown-paragraph-spacing: 1.25rem;
    --markdown-list-spacing: 0.625rem;
    --markdown-heading-spacing: 1.75rem;
    --markdown-code-block-spacing: 1.5rem;
    --markdown-element-spacing: 1rem;
}

/* Dark theme overrides */
.dark {
    --markdown-text-color: #f3f4f6; /* Light gray for better readability */
    --markdown-heading-color: #ffffff; /* Pure white for headings */
    --markdown-link-color: #60a5fa; /* Lighter blue for dark mode */
    --markdown-code-bg: #1e293b; /* Dark blue-gray background for inline code */
    --markdown-code-border: #334155; /* Darker border for code */
    --markdown-blockquote-color: #9ca3af; /* Light gray for blockquotes */
    --markdown-blockquote-border: #4b5563; /* Medium gray border for blockquotes */
    --markdown-table-border: #374151; /* Dark gray for table borders */
    --markdown-table-header-bg: #1f2937; /* Darker gray for table headers */
    --markdown-hr-color: #374151; /* Dark gray for horizontal rules */
    --markdown-pre-bg: #0f172a; /* Dark blue-gray for code blocks */
    --markdown-pre-border: #1e293b; /* Darker border for code blocks */
}

/* Base text styling */
.markdown-content {
    font-family: var(--markdown-font-family);
    font-size: var(--markdown-font-size);
    line-height: var(--markdown-line-height);
    color: var(--markdown-text-color);
    max-width: 100%; /* Allow content to fill available space */
    word-break: break-word;
    overflow-wrap: break-word;
    text-align: left;
    letter-spacing: 0.01em;
    text-rendering: optimizeLegibility;
}

/* Paragraph styling */
.prose p {
    color: var(--markdown-text-color) !important;
    margin-bottom: var(--markdown-paragraph-spacing);
    line-height: var(--markdown-line-height);
    font-size: var(--markdown-font-size);
    transition: color 0.2s ease;
}

/* Heading styling with proper hierarchy and enhanced spacing */
.prose h1,
.prose h2,
.prose h3,
.prose h4,
.prose h5,
.prose h6 {
    color: var(--markdown-heading-color) !important;
    font-family: var(--markdown-font-family);
    line-height: 1.3;
    margin-top: var(--markdown-heading-spacing);
    margin-bottom: 1rem; /* Increased from 0.75rem */
    transition: color 0.2s ease;
    scroll-margin-top: 4rem;
}

.prose h1 {
    font-size: 1.875rem; /* 30px */
    font-weight: var(--markdown-font-weight-bold);
    margin-top: 3rem; /* Increased from 2.5rem */
    margin-bottom: 1.5rem; /* Increased from 1rem */
    letter-spacing: -0.025em;
}

.prose h2 {
    font-size: 1.5rem; /* 24px */
    font-weight: var(--markdown-font-weight-semibold);
    border-bottom: 1px solid var(--markdown-hr-color);
    padding-bottom: 0.5rem;
    margin-top: 2.5rem; /* Increased from 2rem */
    margin-bottom: 1.25rem; /* Increased from 1rem */
    letter-spacing: -0.0125em;
}

.prose h3 {
    font-size: 1.25rem; /* 20px */
    font-weight: var(--markdown-font-weight-semibold);
    margin-top: 2.25rem; /* Increased from 1.75rem */
    margin-bottom: 1rem; /* Increased from 0.75rem */
}

.prose h4 {
    font-size: 1.125rem; /* 18px */
    font-weight: var(--markdown-font-weight-medium);
    margin-top: 2rem; /* Increased from 1.5rem */
    margin-bottom: 1rem; /* Increased from 0.75rem */
}

.prose h5 {
    font-size: 1rem; /* 16px */
    font-weight: var(--markdown-font-weight-semibold);
    margin-top: 1.75rem; /* Increased from 1.25rem */
    margin-bottom: 0.75rem; /* Increased from 0.5rem */
}

.prose h6 {
    font-size: 0.875rem; /* 14px */
    font-weight: var(--markdown-font-weight-semibold);
    text-transform: uppercase;
    letter-spacing: 0.05em;
    margin-top: 1.75rem; /* Increased from 1.25rem */
    margin-bottom: 0.75rem; /* Increased from 0.5rem */
}

/* List styling with improved spacing and bullets */
.prose ul,
.prose ol {
    margin-top: var(--markdown-element-spacing);
    margin-bottom: var(--markdown-element-spacing);
    padding-left: 1.75rem;
}

.prose li {
    color: var(--markdown-text-color) !important;
    margin-top: var(--markdown-list-spacing);
    margin-bottom: var(--markdown-list-spacing);
    line-height: var(--markdown-line-height);
    font-size: var(--markdown-font-size);
    transition: color 0.2s ease;
    padding-left: 0.25rem;
}

.prose ul > li {
    list-style-type: disc;
}

.prose ol > li {
    list-style-type: decimal;
}

/* Nested lists with improved hierarchy */
.prose ul ul,
.prose ol ul {
    list-style-type: circle;
    margin-top: 0.5rem;
    margin-bottom: 0.5rem;
}

.prose ul ul ul,
.prose ol ul ul {
    list-style-type: square;
}

/* Link styling with improved accessibility */
.prose a:not(.anchor) {
    color: var(--markdown-link-color) !important;
    text-decoration: underline;
    text-underline-offset: 0.2em;
    text-decoration-thickness: 0.08em;
    transition: all 0.2s ease;
    font-weight: var(--markdown-font-weight-medium);
}

.prose a:not(.anchor):hover {
    text-decoration: none;
    opacity: 0.9;
}

/* Blockquote styling with improved typography */
.prose blockquote {
    color: var(--markdown-blockquote-color) !important;
    border-left: 4px solid var(--markdown-blockquote-border);
    padding: 0.5rem 0 0.5rem 1.25rem;
    font-style: italic;
    margin: 1.5rem 0;
    background-color: rgba(0, 0, 0, 0.02);
    border-radius: 0.25rem;
}

.prose blockquote p {
    color: var(--markdown-blockquote-color) !important;
    margin-bottom: 0.75rem;
}

.prose blockquote p:last-child {
    margin-bottom: 0;
}

/* Code styling with improved readability */
.prose code:not([class*='language-']) {
    color: var(--markdown-text-color);
    background-color: var(--markdown-code-bg);
    border: 1px solid var(--markdown-code-border);
    padding: 0.2rem 0.4rem;
    border-radius: 0.25rem;
    font-size: 0.875rem;
    font-family:
        'SF Mono', SFMono-Regular, ui-monospace, Menlo, Monaco, Consolas, 'Liberation Mono',
        'Courier New', monospace;
    white-space: nowrap;
}

/* Pre (code block) styling with improved readability */
.prose pre {
    background-color: var(--markdown-pre-bg);
    border: 1px solid var(--markdown-pre-border);
    border-radius: 0.5rem;
    padding: 1rem;
    margin: var(--markdown-code-block-spacing) 0;
    overflow-x: auto;
    font-size: 0.875rem;
    line-height: 1.6;
}

.prose pre code {
    color: var(--markdown-text-color);
    background-color: transparent;
    border: none;
    padding: 0;
    font-size: 0.875rem;
    font-family:
        'SF Mono', SFMono-Regular, ui-monospace, Menlo, Monaco, Consolas, 'Liberation Mono',
        'Courier New', monospace;
    white-space: pre;
}

/* Table styling with improved readability and robustness */
.prose table {
    width: 100%;
    table-layout: auto;
    text-align: left;
    margin: var(--markdown-element-spacing) 0;
    border-collapse: separate;
    border-spacing: 0;
    border: 1px solid var(--markdown-table-border);
    border-radius: 0.5rem;
    overflow: hidden;
    /* Enhanced safety measures */
    contain: layout style;
    content-visibility: auto;
    transform: translateZ(0);
}

.prose thead {
    background-color: var(--markdown-table-header-bg);
}

.prose th {
    padding: 0.75rem 1rem;
    font-weight: var(--markdown-font-weight-semibold);
    color: var(--markdown-text-color) !important;
    border-bottom: 2px solid var(--markdown-table-border);
    font-size: 0.875rem;
    text-transform: uppercase;
    letter-spacing: 0.05em;
    /* Prevent text overflow issues */
    word-wrap: break-word;
    overflow-wrap: break-word;
}

.prose td {
    padding: 0.75rem 1rem;
    color: var(--markdown-text-color) !important;
    border-top: 1px solid var(--markdown-table-border);
    vertical-align: top;
    font-size: var(--markdown-font-size);
    /* Prevent text overflow issues */
    word-wrap: break-word;
    overflow-wrap: break-word;
    max-width: 0; /* Allow flexible column widths */
}

.prose tr:first-child td {
    border-top: none;
}

/* Horizontal rule with improved styling */
.prose hr {
    border: 0;
    border-top: 1px solid var(--markdown-hr-color);
    margin: 2rem 0;
}

/* Strong and emphasis with improved contrast */
.prose strong {
    color: var(--markdown-heading-color) !important;
    font-weight: var(--markdown-font-weight-semibold);
}

.prose em {
    color: var(--markdown-text-color) !important;
    font-style: italic;
}

/* Images with improved display */
.prose img {
    margin: 1.5rem 0;
    border-radius: 0.5rem;
    max-width: 100%;
    height: auto;
    display: block;
    box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
}

/* Ensure proper text color in error messages with transitions */
.markdown-text {
    color: var(--markdown-text-color) !important;
    font-family: var(--markdown-font-family);
    font-size: var(--markdown-font-size);
    line-height: var(--markdown-line-height);
    transition: color 0.2s ease;
}

/* Hardware acceleration for smooth streaming animations */
.markdown-content {
    transform: translateZ(0);
    will-change: contents;
    backface-visibility: hidden;
    -webkit-font-smoothing: antialiased;
    -moz-osx-font-smoothing: grayscale;
    contain: layout style;
    isolation: isolate;
}

/* Optimize text rendering during streaming */
.markdown-content p,
.markdown-content div,
.markdown-content span {
    contain: layout style;
}

/* Accessibility improvements */
@media (prefers-reduced-motion: reduce) {
    .prose *,
    .markdown-text,
    .markdown-content {
        transition: none !important;
        animation: none !important;
        will-change: auto !important;
    }
}

/* High contrast mode improvements */
@media (forced-colors: active) {
    .prose a:not(.anchor) {
        text-decoration: underline !important;
    }

    .prose blockquote {
        border-left-color: CanvasText;
    }

    .prose code,
    .prose pre {
        border: 1px solid CanvasText;
    }
}

/* Force immediate color update on theme change */
html.light .markdown-text,
html.light .prose p,
html.light .prose li,
html.light .prose h1,
html.light .prose h2,
html.light .prose h3,
html.light .prose h4,
html.light .prose h5,
html.light .prose h6,
html.light .prose strong,
html.light .prose em,
html.light .prose blockquote,
html.light .prose td,
html.light .prose th {
    color: var(--markdown-text-color) !important;
}

html.dark .markdown-text,
html.dark .prose p,
html.dark .prose li,
html.dark .prose h1,
html.dark .prose h2,
html.dark .prose h3,
html.dark .prose h4,
html.dark .prose h5,
html.dark .prose h6,
html.dark .prose strong,
html.dark .prose em,
html.dark .prose blockquote,
html.dark .prose td,
html.dark .prose th {
    color: var(--markdown-text-color) !important;
}

/* Additional spacing improvements */
.prose > *:first-child {
    margin-top: 0;
}

.prose > *:last-child {
    margin-bottom: 0;
}

/* Improved code block syntax highlighting */
.prose pre[class*='language-'] {
    position: relative;
    padding-top: 1.5rem;
}

.prose pre[class*='language-']::before {
    content: attr(data-language);
    position: absolute;
    top: 0.25rem;
    right: 0.75rem;
    font-size: 0.75rem;
    color: var(--markdown-blockquote-color);
    text-transform: uppercase;
    letter-spacing: 0.05em;
}

/* Mobile optimizations */
@media (max-width: 640px) {
    :root {
        --markdown-font-size: 15px;
        --markdown-paragraph-spacing: 1rem;
        --markdown-element-spacing: 0.875rem;
    }

    .prose h1 {
        font-size: 1.5rem;
    }

    .prose h2 {
        font-size: 1.25rem;
    }

    .prose h3 {
        font-size: 1.125rem;
    }

    .prose pre {
        padding: 0.75rem;
    }

    .prose table {
        display: block;
        overflow-x: auto;
    }
}

/* Performance optimizations for smooth rendering */
.markdown-content {
    contain: layout style;
    content-visibility: auto;
    contain-intrinsic-size: 0 500px;
    transform: translateZ(0);
    will-change: contents;
    backface-visibility: hidden;
    -webkit-font-smoothing: antialiased;
    -moz-osx-font-smoothing: grayscale;
}

/* Table optimizations to prevent infinite loops */
.markdown-content table {
    contain: layout style;
    content-visibility: auto;
    table-layout: fixed;
    width: 100%;
    border-collapse: collapse;
    transform: translateZ(0);
}

.markdown-content th,
.markdown-content td {
    contain: layout style;
    word-wrap: break-word;
    overflow-wrap: break-word;
    hyphens: auto;
}

/* Prevent layout shifts during streaming */
.markdown-content pre {
    contain: layout style;
    content-visibility: auto;
    overflow-x: auto;
    white-space: pre-wrap;
    word-break: break-word;
}

.markdown-content code {
    contain: layout style;
    word-break: break-word;
}

/* Optimize list rendering */
.markdown-content ul,
.markdown-content ol {
    contain: layout style;
    content-visibility: auto;
}

.markdown-content li {
    contain: layout style;
}

/* Optimize image rendering */
.markdown-content img {
    contain: layout style;
    content-visibility: auto;
    max-width: 100%;
    height: auto;
    transform: translateZ(0);
}

/* Optimize blockquote rendering */
.markdown-content blockquote {
    contain: layout style;
    content-visibility: auto;
    transform: translateZ(0);
}

/* Optimized animations */
@keyframes fade-in {
    from {
        opacity: 0;
        transform: translateY(2px);
    }
    to {
        opacity: 1;
        transform: translateY(0);
    }
}

.animate-fade-in {
    animation: fade-in 0.15s ease-out;
    animation-fill-mode: both;
}

/* Hardware acceleration for better performance */
.transform-gpu {
    transform: translateZ(0);
    will-change: transform;
    backface-visibility: hidden;
}

/* Optimize streaming content */
.streaming-content {
    contain: layout style;
    content-visibility: auto;
    contain-intrinsic-size: 0 200px;
}

/* Reduce reflow during content updates */
.message-container {
    contain: layout style;
    isolation: isolate;
}

/* Optimize scrolling performance */
.chat-scroll-container {
    contain: layout style;
    overflow-anchor: auto;
    scroll-behavior: smooth;
}

/* Prevent markdown rendering from getting stuck on problematic patterns */
.markdown-content {
    /* Add timeout protection for long-running operations */
    animation-duration: 0.15s;
    animation-timing-function: ease-out;
    animation-fill-mode: both;
}

/* Ensure proper isolation between sidebar views */
.desktop-sidebar {
    isolation: isolate;
    z-index: 50;
}

.side-drawer {
    isolation: isolate;
    z-index: 10;
}

/* Shimmer animation for loading states */
@keyframes shimmer {
    0% {
        transform: translateX(-100%);
    }
    100% {
        transform: translateX(100%);
    }
}
